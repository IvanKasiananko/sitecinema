{% extends 'cinema_base.html' %}
{% block content %}

<style>
  .main-photo {
    width: 100%;
    max-height: 400px;
    object-fit: cover;
  }

  .green-btn {
    display: inline-block;
    background-color: green;
    color: white;
    padding: 10px 20px;
    text-decoration: none;
    font-weight: bold;
    border-radius: 4px;
    margin: 10px 0;
  }

  .cinema-layout {
    display: flex;
    gap: 20px;
    align-items: flex-start;
  }

  .left-column {
    width: 300px;
  }

  .banner-photo, .placeholder-banner {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 4px;
    margin-bottom: 10px;
  }

  .placeholder-banner {
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #e0e0e0;
    color: #666;
    font-weight: bold;
  }

  .sidebar {
    background-color: #f5f5f5;
    padding: 10px;
  }

  .session-item {
    border: 1px solid #ccc;
    padding: 5px;
    margin-bottom: 5px;
    text-align: center;
    border-radius: 4px;
  }

  .description-section {
    flex: 1;
  }

  .sheme-photo {
    display: block;
    max-width: 100%;
    margin: auto;
    border-radius: 4px;
    border: 1px solid #ccc;
  }

  .carousel-container {
    position: relative;
    overflow: hidden;
    width: 100%;
    max-width: 600px;
    margin: auto;
  }

  .carousel-slide {
    display: flex;
    transition: transform 0.5s ease-in-out;
  }

  .carousel-slide img {
    width: 100%;
    flex-shrink: 0;
    border-radius: 4px;
    max-height: 300px;
    object-fit: cover;
  }

  .carousel-dots {
    text-align: center;
    margin-top: 10px;
  }

  .dot {
    display: inline-block;
    height: 10px;
    width: 10px;
    margin: 0 5px;
    background-color: #bbb;
    border-radius: 50%;
    cursor: pointer;
  }

  .dot.active {
    background-color: #717171;
  }

  .prev, .next {
    cursor: pointer;
    position: absolute;
    top: 50%;
    padding: 10px;
    color: black;
    font-weight: bold;
    font-size: 18px;
    background-color: rgba(255,255,255,0.7);
    border-radius: 3px;
    user-select: none;
  }

  .prev:hover, .next:hover {
    background-color: rgba(200,200,200,0.9);
  }

  .prev { left: 0; }
  .next { right: 0; }
</style>

<!-- üî∑ –ì–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ -->
<img src="{{ hall.cinema.logo.url }}" alt="{{ hall.name_hall }}" class="main-photo">

<!--&lt;!&ndash; üî∑ –ó–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–µ–∞–Ω—Å–æ–≤ (–ø–æ —Ü–µ–Ω—Ç—Ä—É) &ndash;&gt;-->
<!--<div style="text-align: center;">-->
<!--  <a href="{% url 'schedule' %}" class="green-btn">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–µ–∞–Ω—Å–æ–≤</a>-->
<!--</div>-->

<!-- üî∑ –û–±—â–∏–π flex-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
<div class="cinema-layout">

  <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –±–∞–Ω–Ω–µ—Ä + —Å–∞–π–¥–±–∞—Ä -->
  <div class="left-column">

    <!-- üî∑ –ë–∞–Ω–Ω–µ—Ä -->
    {% if hall.banner %}
      <img src="{{ hall.banner.url }}" alt="–ë–∞–Ω–Ω–µ—Ä" class="banner-photo">
    {% else %}
      <div class="banner-photo placeholder-banner">–ë–∞–Ω–Ω–µ—Ä</div>
    {% endif %}

    <!-- üî∑ Sidebar -->
    <div class="sidebar">
      <h3>–°–º–æ—Ç—Ä–∏—Ç–µ —Å–µ–≥–æ–¥–Ω—è:</h3>
      <div class="today-sessions">
        {% for s in sessions_today %}
          <div class="session-item">
            {{ s.film.name }}<br>{{ s.time_session|time:"H:i" }} | {{ s.type_film }}
          </div>
        {% empty %}
          <div>–ù–µ—Ç —Å–µ–∞–Ω—Å–æ–≤</div>
        {% endfor %}
      </div>

      <!-- üî∑ –ó–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–µ–∞–Ω—Å–æ–≤ -->
      <div style="text-align: center;">
        <a href="{% url 'schedule' %}" class="green-btn">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–µ–∞–Ω—Å–æ–≤</a>
      </div>
    </div>
  </div>

  <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –æ–ø–∏—Å–∞–Ω–∏–µ, –∫–∞—Ä—Ç–∞ –∑–∞–ª–∞, –≥–∞–ª–µ—Ä–µ—è -->
  <div class="description-section">
    <h2 align="center">{{ hall.name_hall }}</h2>
    <div>{{ hall.description }}</div>

    <!-- üî∑ –ö–∞—Ä—Ç–∞ –∑–∞–ª–∞ –≤–º–µ—Å—Ç–æ —É—Å–ª–æ–≤–∏–π -->
    <h2 align="center">–ö–∞—Ä—Ç–∞ –∑–∞–ª–∞</h2>
    {% if hall.sheme %}
      <img src="{{ hall.sheme.url }}" alt="–ö–∞—Ä—Ç–∞ –∑–∞–ª–∞" class="sheme-photo">
    {% else %}
      <p align="center">–ö–∞—Ä—Ç–∞ –∑–∞–ª–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.</p>
    {% endif %}

    <!-- üî∑ –ö–∞—Ä—É—Å–µ–ª—å –±–∞–Ω–Ω–µ—Ä–æ–≤ -->
    <h2 align="center">–§–æ—Ç–æ–≥–∞–ª–µ—Ä–µ—è</h2>

    {% if hall.gall %}
      <div class="carousel-container" id="carousel">
        <div class="carousel-slide">
          {% for image in hall.gall.image_set.all %}
            <img src="{{ image.image.url }}" alt="">
          {% empty %}
            <p>–ù–µ—Ç —Ñ–æ—Ç–æ</p>
          {% endfor %}
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –≤–ª–µ–≤–æ –∏ –≤–ø—Ä–∞–≤–æ -->
        <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
        <a class="next" onclick="plusSlides(1)">&#10095;</a>

        <div class="carousel-dots">
          {% for image in hall.gall.image_set.all %}
            <span class="dot" onclick="currentSlide({{ forloop.counter0 }})"></span>
          {% endfor %}
        </div>
      </div>
    {% else %}
      <p>–ì–∞–ª–µ—Ä–µ—è –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω–∞</p>
    {% endif %}
  </div>
</div>

<script>
  let currentIndex = 0;

  function showSlide(index) {
    const slides = document.querySelector('.carousel-slide');
    const dots = document.querySelectorAll('.dot');
    const totalSlides = dots.length;

    if (index >= totalSlides) currentIndex = 0;
    else if (index < 0) currentIndex = totalSlides - 1;
    else currentIndex = index;

    slides.style.transform = 'translateX(' + (-currentIndex * 100) + '%)';

    dots.forEach(dot => dot.classList.remove('active'));
    dots[currentIndex].classList.add('active');
  }

  function plusSlides(n) {
    showSlide(currentIndex + n);
  }

  function currentSlide(index) {
    showSlide(index);
  }

  // –ê–≤—Ç–æ-–ø—Ä–æ–∫—Ä—É—Ç–∫–∞
  setInterval(() => {
    showSlide(currentIndex + 1);
  }, 5000);

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  document.addEventListener('DOMContentLoaded', () => {
    showSlide(0);

    // Swipe –∂–µ—Å—Ç—ã
    const carousel = document.getElementById('carousel');
    let startX;

    carousel.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
    });

    carousel.addEventListener('touchend', (e) => {
      let endX = e.changedTouches[0].clientX;
      if (startX - endX > 50) plusSlides(1);
      else if (endX - startX > 50) plusSlides(-1);
    });
  });
</script>

{% endblock %}