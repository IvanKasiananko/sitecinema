{% extends 'admin_base.html'%}
{% load static %}
{% block content%}
  <h1 align="center">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h1><a href="{% url 'useradd' %}">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</a>
<h2>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>

<table id="users-table" class="display" style="width:100%">
    <thead>
        <tr>
            <th>ID</th>
            <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
            <th>–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è</th>
            <th>Email</th>
            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
            <th>–§–ò–û</th>
            <th>–ü—Å–µ–≤–¥–æ–Ω–∏–º</th>
            <th>–ì–æ—Ä–æ–¥</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º jQuery –∏ DataTables -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<!--<script src="{% static 'js/csrf.js' %}"></script>-->

<script>
$(document).ready(function() {
    $('#users-table').DataTable({
        processing: true,
        serverSide: true,
        ajax: {
            url: "{% url 'user_json' %}",
            type: 'GET'
        },
        columns: [
            { data: 'id', name: 'id' },
            { data: 'registration_date', name: 'registration_date' },
            { data: 'birthday', name: 'birthday' },
            { data: 'email', name: 'email' },
            { data: 'phone_user', name: 'phone_user' },
            { data: 'full_name', name: 'full_name' },
            { data: 'username', name: 'username' },
            { data: 'town', name: 'town' },
            {
                data: null,
                orderable: false,
                searchable: false,
                render: function (data, type, row) {
                    return `
                    <a href="{{ edit_url_base }}${id}/edit/" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                     &nbsp;
                     <a href="#" class="delete-news" data-id="${id}" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</a>
                    `;
                }
            }
        ]
    });
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ —É–¥–∞–ª–µ–Ω–∏—è
    $('#users-table').on('click', '.delete-btn', function() {
        const userId = $(this).data('id');
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
            $.ajax({
                url: "{% url 'user_delete'  %}",
                method: 'POST',
                data: {
                    'id': userId,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(response) {
                    if (response.success) {
                        $('#users-table').DataTable().ajax.reload();
                        alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—ë–Ω');
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏');
                    }
                },
                error: function() {
                    alert('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞');
                }
            });
        }
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî —Ç—É—Ç –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç –∏–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É
    $('#users-table').on('click', '.edit-btn', function() {
        const userId = $(this).data('id');
        window.location.href = `/user/edit/${userId}/`; // –ø—Ä–∏–º–µ—Ä —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    });

});
</script>
{% endblock %}
